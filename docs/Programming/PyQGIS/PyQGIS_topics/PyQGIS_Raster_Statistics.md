# ­ЪД« Raster Statistics & Calculations Рђћ PyQGIS

PyQGIS рЃњрЃЋрЃљрЃФрЃџрЃћрЃЋрЃА рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃљрЃА рЃЏрЃЮрЃЋрЃљрЃ«рЃЊрЃўрЃюрЃЮрЃЌ рЃарЃљрЃАрЃбрЃарЃБрЃџрЃў рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃАрЃбрЃљрЃбрЃўрЃАрЃбрЃўрЃЎрЃБрЃарЃў рЃљрЃюрЃљрЃџрЃўрЃќрЃў, рЃърЃўрЃЦрЃАрЃћрЃџрЃћрЃЉрЃўрЃА рЃљрЃЏрЃЮрЃдрЃћрЃЉрЃљ, рЃЏрЃљрЃЌрЃћрЃЏрЃљрЃбрЃўрЃЎрЃБрЃарЃў рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃћрЃЉрЃў рЃЊрЃљ рЃАрЃ«рЃЋрЃљ рЃАрЃ«рЃЋрЃљрЃЊрЃљрЃАрЃ«рЃЋрЃљ рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃџрЃћрЃЉрЃў.

---

## ­ЪЊі **Statistics 1 Рђћ рЃарЃљрЃАрЃбрЃарЃБрЃџрЃў рЃАрЃбрЃљрЃбрЃўрЃАрЃбрЃўрЃЎрЃљ (рЃЏрЃўрЃюрЃўрЃЏрЃБрЃЏрЃў, рЃЏрЃљрЃЦрЃАрЃўрЃЏрЃБрЃЏрЃў рЃЊрЃљ рЃАрЃ«рЃЋ.)**

рЃљрЃЏ рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃерЃў рЃњрЃљрЃЏрЃЮрЃўрЃЌрЃЋрЃџрЃћрЃЉрЃљ рЃарЃљрЃАрЃбрЃарЃБрЃџрЃў рЃцрЃћрЃюрЃўрЃА рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃАрЃбрЃљрЃбрЃўрЃАрЃбрЃўрЃЎрЃБрЃарЃў рЃЏрЃљрЃ«рЃљрЃАрЃўрЃљрЃЌрЃћрЃЉрЃџрЃћрЃЉрЃў Рђћ **рЃЏрЃўрЃюрЃўрЃЏрЃБрЃЏрЃў**, **рЃЏрЃљрЃЦрЃАрЃўрЃЏрЃБрЃЏрЃў**, **рЃАрЃљрЃерЃБрЃљрЃџрЃЮ**, **рЃЊрЃўрЃљрЃърЃљрЃќрЃЮрЃюрЃў**, **рЃ»рЃљрЃЏрЃў** рЃЊрЃљ **рЃЎрЃЋрЃљрЃЊрЃарЃљрЃбрЃћрЃЉрЃўрЃА рЃ»рЃљрЃЏрЃў**.

```python
fn = r'C:\Users\Public\Documents\GK\PyQGIS\shp\tema_9\Raster\DEM\dem.tif'

rlayer = iface.addRasterLayer(fn)

stats = rlayer.dataProvider().bandStatistics(1, QgsRasterBandStats.All)

print("minimumValue:", stats.minimumValue)
print("maximumValue:", stats.maximumValue)
print("mean:", stats.mean)
print("range:", stats.range)
print("sum:", stats.sum)
print("sumOfSquares:", stats.sumOfSquares)
```

**рЃерЃћрЃЊрЃћрЃњрЃўрЃА рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў:**
```
minimumValue:  -18.0  
maximumValue:  5035.0  
mean:  1233.8903706592614  
range:  5053.0  
sum:  13471455895.0  
sumOfSquares:  7804600900270.026
```

---

## ­ЪЊЇ **Statistics 2 Рђћ рЃърЃўрЃЦрЃАрЃћрЃџрЃўрЃА рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃўрЃА рЃљрЃЏрЃЮрЃдрЃћрЃЉрЃљ рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџ рЃгрЃћрЃарЃбрЃўрЃџрЃќрЃћ**

­ЪЉЅ рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџрЃў рЃЎрЃЮрЃЮрЃарЃЊрЃўрЃюрЃљрЃбрЃўрЃА рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃљрЃА рЃарЃљрЃАрЃбрЃарЃерЃў.  
рЃЌрЃБ рЃгрЃћрЃарЃбрЃўрЃџрЃў рЃАрЃфрЃЊрЃћрЃЉрЃљ рЃарЃљрЃАрЃбрЃарЃўрЃА рЃАрЃљрЃќрЃдрЃЋрЃарЃћрЃЉрЃА, рЃЊрЃљрЃЉрЃарЃБрЃюрЃЊрЃћрЃЉрЃљ `False`.

```python
fn = r'C:\Users\Public\Documents\GK\PyQGIS\shp\tema_9\Raster\DEM\dem.tif'

rlayer = iface.addRasterLayer(fn)

val, res = rlayer.dataProvider().sample(QgsPointXY(474517, 4615243), 1)

print(val, res)
```

­ЪЊў **рЃерЃћрЃюрЃўрЃерЃЋрЃюрЃљ:**
- рЃЌрЃБ `res = True`, рЃЏрЃљрЃерЃўрЃю `val` рЃерЃћрЃўрЃфрЃљрЃЋрЃА рЃърЃўрЃЦрЃАрЃћрЃџрЃўрЃА рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃљрЃА.  
- рЃЌрЃБ `res = False`, рЃгрЃћрЃарЃбрЃўрЃџрЃў рЃарЃљрЃАрЃбрЃарЃўрЃА рЃцрЃљрЃарЃњрЃџрЃћрЃЉрЃА рЃњрЃљрЃарЃћрЃЌрЃљрЃљ.

---

## ­ЪДа **Statistics 3 Рђћ рЃарЃљрЃАрЃбрЃарЃБрЃџрЃў рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃўрЃА рЃгрЃљрЃЎрЃўрЃЌрЃ«рЃЋрЃљ рЃарЃЮрЃњрЃЮрЃарЃф Array**

­ЪЉЅ рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃБрЃцрЃарЃЮ рЃдрЃарЃЏрЃљ рЃљрЃюрЃљрЃџрЃўрЃќрЃўрЃАрЃЌрЃЋрЃўрЃА рЃерЃћрЃАрЃљрЃФрЃџрЃћрЃЉрЃћрЃџрЃўрЃљ рЃЏрЃЌрЃћрЃџрЃў рЃарЃљрЃАрЃбрЃарЃБрЃџрЃў рЃЏрЃљрЃбрЃарЃўрЃфрЃўрЃА рЃгрЃљрЃЎрЃўрЃЌрЃ«рЃЋрЃљ `gdal` рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃЌ.

```python
from osgeo import gdal

fn = r'C:\Users\Public\Documents\GK\PyQGIS\shp\tema_9\Raster\DEM\dem.tif'

rlayer = iface.addRasterLayer(fn)

ds = gdal.Open(rlayer.dataProvider().dataSourceUri())
tin_arr = ds.GetRasterBand(1).ReadAsArray()

print(tin_arr)           # рЃЏрЃЌрЃџрЃўрЃљрЃюрЃў Array
print(len(tin_arr))      # рЃарЃўрЃњрЃћрЃЉрЃўрЃА рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ
print(len(tin_arr[0]))   # рЃАрЃЋрЃћрЃбрЃћрЃЉрЃўрЃА рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ
print(tin_arr[1200][1200])  # рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџрЃў рЃърЃўрЃЦрЃАрЃћрЃџрЃўрЃА рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃљ
```

**рЃерЃћрЃЊрЃћрЃњрЃўрЃА рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў:**
```
[[255. 255. 255. 255. 255. 255.]
 [255. 255. 255. 255. 255. 255.]
 ...
 [255. 255. 255. 255. 255. 255.]]
3644
6883
255.0
```

---

## ­ЪД« **Raster Calculator Рђћ рЃарЃљрЃАрЃбрЃарЃўрЃА рЃЎрЃљрЃџрЃЎрЃБрЃџрЃљрЃбрЃЮрЃарЃў PyQGIS-рЃерЃў**

­ЪЉЅ рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЉрЃљ рЃЏрЃљрЃарЃбрЃўрЃЋрЃў рЃЏрЃљрЃЌрЃћрЃЏрЃљрЃбрЃўрЃЎрЃБрЃарЃў рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃћрЃЉрЃўрЃА рЃерЃћрЃАрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃџрЃљрЃЊ рЃарЃљрЃАрЃбрЃћрЃарЃќрЃћ (рЃЏрЃљрЃњ. рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃћрЃЉрЃўрЃА рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ рЃљрЃю рЃњрЃљрЃЏрЃарЃљрЃЋрЃџрЃћрЃЉрЃљ).

```python
from osgeo import gdal

fn = r'C:\Users\Public\Documents\GK\PyQGIS\shp\tema_9\Raster\DEM\dem.tif'

lyr1 = QgsRasterLayer(fn)
out = r'C:\Users\Public\Documents\GK\PyQGIS\shp\tema_9\Raster\DEM\dem_calc.tif'

entries = []

ras = QgsRasterCalculatorEntry()
ras.ref = 'ras@1'
ras.raster = lyr1
ras.bandNumber = 1
entries.append(ras)

calc = QgsRasterCalculator(
    'ras@1 + 25.7',  # рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў: рЃЌрЃўрЃЌрЃЮрЃћрЃБрЃџ рЃърЃўрЃЦрЃАрЃћрЃџрЃА рЃћрЃЏрЃљрЃбрЃћрЃЉрЃљ 25.7
    out,
    'GTiff',
    lyr1.extent(),
    lyr1.width(),
    lyr1.height(),
    entries
)

calc.processCalculation()
iface.addRasterLayer(out)
```

---

­ЪЊў **рЃерЃћрЃюрЃўрЃерЃЋрЃюрЃљ:**  
`QgsRasterCalculator` рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃљрЃА рЃњрЃљрЃФрЃџрЃћрЃЋрЃЌ рЃерЃћрЃЦрЃЏрЃюрЃљрЃЌ рЃљрЃ«рЃљрЃџрЃў рЃарЃљрЃАрЃбрЃарЃў рЃАрЃ«рЃЋрЃљрЃЊрЃљрЃАрЃ«рЃЋрЃљ рЃЏрЃљрЃЌрЃћрЃЏрЃљрЃбрЃўрЃЎрЃБрЃарЃў рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃџрЃћрЃЉрЃўрЃЌ (рЃЏрЃљрЃњ. `ras@1 * 2`, `ras@1 - 100` рЃЊрЃљ рЃАрЃ«рЃЋ.).

---

РюЁ **рЃЊрЃљрЃАрЃЎрЃЋрЃюрЃљ:**  
PyQGIS рЃўрЃФрЃџрЃћрЃЋрЃљ рЃФрЃџрЃўрЃћрЃа рЃўрЃюрЃАрЃбрЃарЃБрЃЏрЃћрЃюрЃбрЃћрЃЉрЃА рЃарЃљрЃАрЃбрЃарЃБрЃџрЃў рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃљрЃюрЃљрЃџрЃўрЃќрЃўрЃАрЃљ рЃЊрЃљ рЃЏрЃљрЃЌрЃќрЃћ рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃћрЃЉрЃўрЃА рЃерЃћрЃАрЃарЃБрЃџрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА Рђћ рЃАрЃбрЃљрЃбрЃўрЃАрЃбрЃўрЃЎрЃљ, рЃърЃўрЃЦрЃАрЃћрЃџрЃБрЃарЃў рЃљрЃЏрЃЮрЃдрЃћрЃЉрЃљ, рЃЏрЃљрЃЌрЃћрЃЏрЃљрЃбрЃўрЃЎрЃБрЃарЃў рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃџрЃћрЃЉрЃў рЃЊрЃљ рЃАрЃарЃБрЃџрЃў рЃЏрЃљрЃбрЃарЃўрЃфрЃўрЃА рЃгрЃЋрЃЊрЃЮрЃЏрЃљ.

---
